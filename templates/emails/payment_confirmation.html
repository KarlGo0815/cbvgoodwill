{% load i18n %}
<!DOCTYPE html>
<html lang="{{ language }}">
<head>
  <meta charset="UTF-8">
  <style>
    body { font-family: sans-serif; color: #333; line-height: 1.6; }
    .box { background: #f9f9f9; padding: 20px; border-radius: 8px; }
    .logo { height: 40px; margin-bottom: 20px; }
    .table { border-collapse: collapse; width: 100%; margin-top: 1em; }
    .table th, .table td { padding: 8px; border-bottom: 1px solid #ddd; }
    .total { font-weight: bold; }
  </style>
</head>
<body>
  <div class="box">
    <img src="https://casabelavista.amt-fuer-liebe-und-dankbarkeit.de/static/logo.png" alt="Logo" class="logo">

    <h2>{% trans "Zahlungsbestätigung" %}</h2>

    <p>
      {% blocktrans with name=lender.first_name %}
        Hallo {{ name }},
      {% endblocktrans %}
    </p>

    <p>{% trans "wir bestätigen den Eingang folgender Zahlung:" %}</p>

    <ul>
      <li><strong>{% trans "Datum" %}:</strong> {{ payment.date }}</li>
      <li><strong>{% trans "Betrag" %}:</strong> {{ payment.original_amount }} {{ payment.currency }}</li>
    </ul>

    <p>{% trans "Bisherige Zahlungen:" %}</p>
    <table class="table">
      <tr>
        <th>{% trans "Datum" %}</th>
        <th>{% trans "Betrag" %}</th>
      </tr>
      {% for p in all_payments %}
        <tr>
          <td>{{ p.date }}</td>
          <td>{{ p.amount_eur }} €</td>
        </tr>
      {% endfor %}
      <tr class="total">
        <td>{% trans "Gesamt" %}</td>
        <td>{{ total_paid }} €</td>
      </tr>
    </table>

    {% if bookings %}
      <p>{% trans "Davon wurden folgende Buchungen abgerechnet:" %}</p>
      <table class="table">
        <tr>
          <th>{% trans "Zeitraum" %}</th>
          <th>{% trans "Wohnung" %}</th>
          <th>{% trans "Kosten" %}</th>
        </tr>
        {% for b in bookings %}
          <tr>
            <td>{{ b.start_date }} – {{ b.end_date }}</td>
            <td>{{ b.apartment.name }}</td>
            <td>{{ b.total_cost }} €</td>
          </tr>
        {% endfor %}
        <tr class="total">
          <td colspan="2">{% trans "Gesamtkosten" %}</td>
          <td>{{ total_used }} €</td>
        </tr>
      </table>
    {% endif %}

    <p>
      <strong>{% trans "Aktuelles Guthaben" %}:</strong>
      {{ balance }} €
    </p>

    <p>{% trans "Herzlichen Dank für Ihre Zahlung!" %}</p>
    <p style="margin-top: 2em;">Casa Bella Vista</p>
  </div>
</body>
</html>
